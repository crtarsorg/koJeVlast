<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Statistike o podacima u sistemu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <base href="./partials">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/js/dataTables.bootstrap.min.js"></script>

    <script src="https://cdn.datatables.net/buttons/1.2.4/js/dataTables.buttons.min.js"></script> 
    <script src="//cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script> 
    <script src="//cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script> 
    <script src="//cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script> 
    <script src="//cdn.datatables.net/buttons/1.2.4/js/buttons.html5.min.js"></script> 


    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
    <!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.13/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.2.4/css/buttons.dataTables.min.css"> -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">


</head>



<style>
.statsrow{
    margin-bottom: 20px;
}

.statbox h3{
    font-size: 18px;
    color: #231f20;
}
.statbox i{
    color: #bdbcbc;
}

.statbox h3 span{
    font-size: 24px;
    color: #62a698;
    margin-left: 10px;
}



.statboxnice{
    text-align: center;
}
.statboxnice h3{
    font-size: 18px;
    color: #64A49C;
    border-top: 7px solid #64A49C;
    text-align: center;
    padding-top: 7px;
    margin: 0;
    margin-bottom: 40px;
}
.statboxnice i{
    color: #bdbcbc;
    cursor: pointer;
}
.triangle {
    min-height:40px;
    width:100%;
    position:relative;
    overflow:hidden;
}
.triangle:after {
    /* min-height: 50px; */
    width: 100%;
    position: relative;
    -webkit-transform: rotate(45deg);
    -moz-transform: rotate(45deg);
    transform: rotate(90deg);
    content: '';
    display: block;
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    /* background-color: red; */
    margin: auto;
    font-size: 0px;
    line-height: 0%;
    width: 0px;
    border-top: 10px solid white;
    border-bottom: 10px solid #fff;
    border-right: 40px solid #64a49c;
}

.statboxnice span{
    font-size: 24px;
    line-height: 80px;
    color: #FFF;
    background-color: #62a698;
    display: block;
    border-radius: 50%;
    width:80px;
    height:80px;
    margin: auto;
}

.highlight-container img{
    max-height: 80px;
    float: left;
}
.highlight{
    min-height: 150px;
    background-color: #62a698;
    border-radius: 20px;
    color: white;
    margin-left: 30px;
    margin-top: 40px;
}
.highlight h3{
    margin-left: 60px;
    padding: 5px;
}

.highlight ul{
    margin-left: 30px;
    list-style-type: none;
}

</style>

<body>
    <div class="container-fluid">


    <div class="row baneri-highlight">
        <div class="highlight-container col-md-3 col-md-offset-1">
            <img src="../static/icons/stats1.svg" alt="">
            <div class="highlight">
                <h3>Najčešće stranke u vlasti</h3>
                <div>
                    <ul id="ul_stranke">

                    </ul>
                </div>
            </div>
        </div>
        <div class="highlight-container col-md-3">
            <img src="../static/icons/stats_2.svg" alt="">
            <div class="highlight">
                <h3>Top 5 preletača</h3>
                <div>
                    <ul id="ul_preletaci">

                    </ul>
                </div>
            </div>
        </div>
        <div class="highlight-container col-md-3">
            <img src="../static/icons/stats_3.svg" alt="">
            <div class="highlight">
                <h3>Opštine sa najviše promena</h3>
                <div>
                    <ul>
                        <li>item1i</li>
                        <li>item2i</li>
                        <li>item3i</li>
                        <li>item4i</li>
                        <li>item5i</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

        <div class="row statsrownice">


            <div class="col-lg-2 statboxnice">
                <span id="brPromena"></span>
                <div class="triangle"></div>
                <h3>Ukupan broj promena<sup><i class="fa fa-question-circle" data-box="hpromena" aria-hidden="true"></i></sup> </h3>
            </div>

            <div class="col-lg-2 statboxnice">
                <span id="opstine"></span>
                <div class="triangle"></div>
                <h3>Broj opština<sup><i class="fa fa-question-circle" data-box="hopstina" aria-hidden="true"></i></sup> </h3>

            </div>

            <div class="col-lg-2 statboxnice">
                <span id="muskarci"></span>
                <div class="triangle"></div>
                <h3>Broj muškaraca<sup><i class="fa fa-question-circle" data-box="hm" aria-hidden="true"></i></sup> </h3>
            </div>

            <div class="col-lg-2 statboxnice">
                <span id="zene"></span>
                <div class="triangle"></div>
                <h3>Broj žena<sup><i class="fa fa-question-circle" data-box="hz" aria-hidden="true"></i></sup>  </h3>
            </div>


            <div class="col-lg-2 statboxnice">
                <span id="regioni"></span>
                <div class="triangle"></div>
                <h3>Broj regiona<sup><i class="fa fa-question-circle" data-box="hreg" aria-hidden="true"></i></sup> </h3>

            </div>

            <div class="col-lg-2 statboxnice">
                <span id="stranke"></span>
                <div class="triangle"></div>
            	<h3>Stranke<sup><i class="fa fa-question-circle" data-box="hstr" aria-hidden="true"></i></sup> </h3>

            </div>



        </div>



        <div class="row statsrow">


        </div>

    </div>


            <div class="col-lg-12">
            	<h3>Akteri po strankama i statusima</h3>
				<table id="strankeTabela">

				</table>
            </div>

<div id="explain" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body">
                <p>Some text in the modal.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>



    <script type="text/javascript">

    function onlyUnique(value, index, self) { 
	    return self.indexOf(value) === index;
	}
    //http://kojenavlasti.rs/api/stats
    $(function() {


    $(".statsrownice i").on("click", function(e){
        //console.dir(e.currentTarget.dataset.box);

        tar = e.currentTarget.dataset.box;
        if(tar=="hpromena"){ $('.modal-title').html('Ukupan broj promena'); $('.modal-body').html('Ovaj broj se odnosi na ukupan broj promena funkcija u lokalnoj samoupravi, promena stranaka, promena koalicija...'); $('#explain').modal('show');   }
        if(tar=="hopstina"){ $('.modal-title').html('Ukupan broj opština'); $('.modal-body').html('Ovaj broj se odnosi na ukupan broj opština u kojima su zabeležene promene'); $('#explain').modal('show');   }
        if(tar=="hm"){ $('.modal-title').html('Broj muškaraca '); $('.modal-body').html('Obajsnjenje za Broj muškaraca '); $('#explain').modal('show');   }
        if(tar=="hz"){ $('.modal-title').html('Broj žena'); $('.modal-body').html('Obajsnjenje za Broj žena'); $('#explain').modal('show');   }
        if(tar=="hreg"){ $('.modal-title').html('Broj regiona'); $('.modal-body').html('Obajsnjenje za Broj regiona'); $('#explain').modal('show');   }
        if(tar=="hstr"){ $('.modal-title').html('Stranke'); $('.modal-body').html('Obajsnjenje za Stranke'); $('#explain').modal('show');   }

    } );



        $.get("./nav.html", function(data) {
            $("body").prepend(data);
        });



        function prveStranke( podaci ) {
            var c = 0;

            for (var i = 0; i < podaci.length; i++) {
                if( c >= 5)return;

                var naziv = podaci[i][0];

                if(["Stranka nije na listi","Nepoznata"].indexOf(naziv) ==-1){
                    $("#ul_stranke").append("<li>"+naziv+"</li>");
                    c++;

                }
            }
        }

        $.get('../api/stats', function(data) {
        	data = JSON.parse(data);
        	data = data.data
        	//console.log( data );

			$("#brPromena").html(data.promena);

        	$("#opstine").html(data.opstina);
        	$("#regioni").html(data.regiona);


        	$("#muskarci").html(data.muskaraca);
        	$("#zene").html(data.zena);

        	$("#stranke").html(data.partija);


        	var zajedno = {};

        	var vlast_stranke  =
				Object.keys(
					data.akteri_aktivni_vlast_stranka);

			var opozicija_stranke  =
				Object.keys(
					data.akteri_aktivni_opozicija_stranka);

			var sve_stranke = vlast_stranke.concat(opozicija_stranke)

        	/*zajedno.vlast = data.akteri_aktivni_vlast_stranka
        		;
        	zajedno.opozicija =
        		data.akteri_aktivni_opozicija_stranka;*/


        	sve_stranke = sve_stranke.filter(onlyUnique)

        	var res = [];
        	for (var i = 0; i < sve_stranke.length; i++) {

        		var temp = {};
        		var temp1 = []
        		temp.naziv = sve_stranke[i];
        		temp.vlast = data.akteri_aktivni_vlast_stranka[sve_stranke[i]] || 0 ;
        		temp.opozicija = data.akteri_aktivni_opozicija_stranka[sve_stranke[i]] || 0 ;

        		temp1 =
        			[temp.naziv,
        			temp.vlast,
        			temp.opozicija ];

        		res.push(temp1)
        	}

            var na_vlasti = res.slice( 0, 10 );
            prveStranke(na_vlasti);


        	$('#strankeTabela').DataTable( {
			        data: res,
			        columns: [
			            { title: "stranka" },
			            { title: "vlast" },
			            { title: "opozicija" }

			        ]
			    } );

        });


        $.get("http://kojenavlasti.rs/api/imajuPromene", function (data) {
            data = JSON.parse(data);
            var prvih_5 = data.slice(0,5);

            for (var i = 0; i < prvih_5.length; i++) {
                var la = prvih_5[i].id;
                $.get("http://kojenavlasti.rs/api/akter/promene/"+la, function(d) {
                    d = JSON.parse(d);
                    d = d[0];
                    $("#ul_preletaci").append("<li><a href='"+'http://kojenavlasti.rs/partials/tabela.html?osoba='+d.aime + " " +d.aprezime+"'>" + d.aime + " " +d.aprezime + "</a></li>")
                    //console.log(d[0]);
                })
            }

            //prodji za svakog i nabavi ime
        })

        function function_name(argument) {
            // body...
        }


    })
    </script>
</body>

</html>
